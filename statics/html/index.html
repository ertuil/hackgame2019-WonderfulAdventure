<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>达拉崩吧大冒险</title>
    <link rel="stylesheet" href="/statics/css/bootstrap.min.css" >
    <link rel="stylesheet" href="/statics/css/default.css" >
    <script src="/statics/js/jquery.min.js" ></script>
    <script src="/statics/js/default.js" ></script>
    <script src="/statics/js/bootstrap.bundle.js"></script>

</head>
<body>

<!-- 这里是 Narbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-primary">
    <a class="navbar-brand text-light" href="#">达拉崩吧大冒险</a>
    <ul class="nav mr-auto">
        <li class="nav-item text-light"><a id="start">重新开始罪恶的一生</a></li>
    </ul>
</nav>

<div class="container outdiv">
    <div class="row updiv">
        <div class="col-8 maindiv">
            <div id="alist">

            </div>
        </div>
        <div class="col-4 sidediv" id="info">
            <h4>Name:</h4>
            <p id="info_name"></p>
            <h4>Money:</h4>
            <p id="info_money"></p>
            <h4>Attack:</h4>
            <p id="info_attack"></p>
        </div>
    </div>
    <div class="container">
        <form class="form-inline">
            <div class="form-group mx-sm-3 mb-2">
                <label for="value" class="sr-only">Input:</label>
                <select id="input">
                </select>
            </div>
            <button id="send"  type="button" class="btn btn-primary mb-2">Send</button>
        </form>
    </div>
</div>

<script>


    let opts;

    let host = window.location.host;
    let ws = new WebSocket("ws://"+host+"/ws");

    ws.onopen = function(evt) {
        addMsg("旁白","进入同步(Websocket连接)！");
    };

    ws.onmessage = function(evt) {
        console.log( "Received Message: " + evt.data);
        js = JSON.parse(evt.data);
        addMsg(js["From"],js["Content"]);
        updateState(js["State"]);
        loadOptions(js["Options"]);
        opts = js["Options"];

        let div = document.getElementById('alist');
        div.scrollTop = div.scrollHeight;
    };

    ws.onclose = function(evt) {
        addMsg("旁白","失去同步！(Websocket结束)");
    };

    $("#send").click(
        function () {
            let v = $("#input option:selected").val();
            addMsg("我", opts[parseInt(v)]);
            ws.send(v)
        }
    );

    $("#start").click(function () {
            if (ws.readyState !== WebSocket.CLOSED){
                ws.close()
            }
            location.reload();
        }
    );

</script>
</body>
</html>